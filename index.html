---
title: "Kolekcija projekata u gradu Zagrebu i njihov trenutni status"
---

<div id="map">
  <button id="ucitajKartuButton" type="button" onclick="ucitajKartu()">Učitaj kartu</button>
</div>

<div class="filteri" id="filteri">
  <button type="button" onclick="prikaziSveProjekte(this)" class="active">Svi projekti</button>
  <button type="button" onclick="prikaziGotoveProjekte(this)">Samo gotovi projekti</button>
</div>

<div class="projekti">

  {% for projekt in site.projekti reversed %}
  <a href="{{ projekt.url }}" class="projekt" id="{{ projekt.id }}">
    <div class="podaci">
      <h2>{{ projekt.ime }}</h2>
      <h3>Trenutna faza: {{ projekt.faza }}</h3>
      <h3>Vrijednost: {{ projekt.vrijednost }}</h3>
      <small>Posljednji put ažurirano: {{ projekt.date | date: "%d.%m.%Y." }}</small>
    </div>
    <div class="slika">
      <picture>
	<source srcset="{{ projekt.slika_url }}.webp" type="image/webp" />
	<img src="{{ projekt.slika_url }}.jpg" alt="{{ projekt.slika_tekst }}">
      </picture>
      <br/>
      <small>{{ projekt.slika_izvor }}</small>
    </div>
  </a>
  {% endfor %}

</div>

<script>
  var kartaUcitana = false;
  var samoGotoviProjekti = false;
  var markeri;
  var map;
  var filteri = document.getElementById("filteri");
  var projekti;  // Projekti su ucitani na kraju skripte.
  
  async function ucitajProjekte() {
      let url = "/api/projekti.html";
      try {
	  const response = await fetch(url);
	  if (!response.ok) {
	      throw new Error(`Response status: ${response.status}`);
	  }
	  const data = await response.text();
	  projekti = JSON.parse(decodeURI(data));
      } catch (error) {
	  console.error(error.message);
      }
  }

  async function ucitajKartu() {
      // Sakri gumb nakon sto je karta ucitana
      document.getElementById("ucitajKartuButton").style.display = 'none';

      map = L.map('map').setView([45.7949, 15.9841], 11);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
	  maxZoom: 19,
	  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      markeri = new Map();

      for (let i = 0; i < projekti.length; i++) {
	  var slika = "<a href='" + projekti[i].url + "' style='max-width: 200px; white-space: pre-wrap; word-wrap: break-word;'>" +  projekti[i].ime +
	      "<picture><source srcset='" + projekti[i].slika_url + ".webp' type='image/webp' /><img src='" + projekti[i].slika_url  + ".jpg' style='width: 200px; aspect-ratio: 4 / 3; object-fit: cover; padding-top: 5px;'> </a>";
	  var marker = L.marker(projekti[i].geo_lokacija);
	  marker.bindPopup(slika);
	  marker.addTo(map);
	  markeri.set(projekti[i].id, marker);
      }

      kartaUcitana = true;
      if (samoGotoviProjekti) {
	  _prikaziGotoveProjekte();
      }
  }

  function fokusirajFilterButton(element) {
      for (var i = 0; i < filteri.children.length; i++) {
	  var child = filteri.children[i];
	  if (child == element) {
	      child.classList.add("active");
	  } else {
	      child.classList.remove("active");
	  }
      }
  }

  function prikaziSveProjekte(element) {
      fokusirajFilterButton(element);

      for (var i = 0; i < projekti.length; i++) {
	  projekt = projekti[i]
	  if (kartaUcitana) {
	      var marker = markeri.get(projekt.id);
	      if (!map.hasLayer(marker)) {
		  marker.addTo(map);
	      }
	  }
	  document.getElementById(projekt.id).style.display = 'flex';
      }
      
      samoGotoviProjekti = false;
  }

  function prikaziGotoveProjekte(element) {
      fokusirajFilterButton(element);
      _prikaziGotoveProjekte();
  }

  function _prikaziGotoveProjekte() {
      for (var i = 0; i < projekti.length; i++) {
	  projekt = projekti[i]
	  var marker;
	  if (kartaUcitana) {
	      marker = markeri.get(projekt.id);
	  }
	  if (projekt.faza != "Dovršeno") {
	      if (kartaUcitana && map.hasLayer(marker)) {
		  marker.removeFrom(map);
	      }
	      document.getElementById(projekt.id).style.display = 'none';
	  } else {
	      if (kartaUcitana && !map.hasLayer(marker)) {
		  marker.addTo(map);
	      }
	      document.getElementById(projekt.id).style.display = 'flex';
	  }
      }
      samoGotoviProjekti = true;
  }

  ucitajProjekte();

</script>
